<VirtualHost *:80>
    ServerAdmin webmaster@example.com
    DocumentRoot "/www/wwwroot/route.biforst.id"
    ServerName 859ab874.route.biforst.id
    ServerAlias route.biforst.id
    #errorDocument 404 /404.html
    IncludeOptional /www/server/panel/vhost/apache/extension/route.biforst.id/*.conf
    ErrorLog "/www/wwwlogs/route.biforst.id-error_log"
    CustomLog "/www/wwwlogs/route.biforst.id-access_log" combined
	#Referenced reverse proxy rule, if commented, the configured reverse proxy will be invalid
	
	IncludeOptional /www/server/panel/vhost/apache/proxy/route.biforst.id/*.conf
	#HTTP_TO_HTTPS_START
    <IfModule mod_rewrite.c>
        RewriteEngine on
        RewriteCond %{SERVER_PORT} !^443$
        RewriteRule (.*) https://%{SERVER_NAME}$1 [L,R=301]
    </IfModule>
    #HTTP_TO_HTTPS_END

    #DENY FILES
     <Files ~ (\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md)$>
       Order allow,deny
       Deny from all
    </Files>
    
    #PHP
    <FilesMatch \.php$>
            SetHandler "proxy:unix:/tmp/php-cgi-00.sock|fcgi://localhost"
    </FilesMatch>
    
    #PATH
    <Directory "/www/wwwroot/route.biforst.id">
        SetOutputFilter DEFLATE
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html index.htm default.php default.html default.htm
    </Directory>
</VirtualHost>
<VirtualHost *:443>
        ServerAdmin webmaster@example.com
        DocumentRoot "/www/wwwroot/route.biforst.id/"
        ServerName SSL.route.biforst.id
        ServerAlias route.biforst.id 
        #errorDocument 404 /404.html
    IncludeOptional /www/server/panel/vhost/apache/extension/route.biforst.id/*.conf
        ErrorLog "/www/wwwlogs/route.biforst.id-error_log"
        CustomLog "/www/wwwlogs/route.biforst.id-access_log" combined
	#Referenced reverse proxy rule, if commented, the configured reverse proxy will be invalid
	
	IncludeOptional /www/server/panel/vhost/apache/proxy/route.biforst.id/*.conf
	#SSL
        SSLEngine On
        SSLCertificateFile /www/server/panel/vhost/cert/route.biforst.id/fullchain.pem
        SSLCertificateKeyFile /www/server/panel/vhost/cert/route.biforst.id/privkey.pem
        SSLCipherSuite EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5:ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL
        SSLProtocol All -SSLv2 -SSLv3 -TLSv1
        SSLHonorCipherOrder On
        
        # WebSocket proxy for Laravel Reverb
        ProxyPreserveHost On
        ProxyRequests Off
    
        # Handle WebSocket upgrade for /livereload path
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} =websocket [NC]
        RewriteCond %{REQUEST_URI} ^/livereload [NC]
        RewriteRule ^/livereload$ ws://127.0.0.1:9966/livereload [P,L]
        RewriteRule ^/livereload/(.*) ws://127.0.0.1:9966/livereload/$1 [P,L]
        
        # Proxy all other requests to the frontend application
        ProxyPass / http://127.0.0.1:9966/
        ProxyPassReverse / http://127.0.0.1:9966/
        
        #PHP
        <FilesMatch \.php$>
                SetHandler "proxy:unix:/tmp/php-cgi-00.sock|fcgi://localhost"
        </FilesMatch>
        
    
        #DENY FILES
         <Files ~ (\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md)$>
           Order allow,deny
           Deny from all
        </Files>
    
        #PATH
        <Directory "/www/wwwroot/route.biforst.id/">
            SetOutputFilter DEFLATE
            Options FollowSymLinks
            AllowOverride All
            Require all granted
            DirectoryIndex index.php index.html index.htm default.php default.html default.htm
        </Directory>
    </VirtualHost>